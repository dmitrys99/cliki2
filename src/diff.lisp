(in-package #:cliki2)
(in-readtable cliki2)

(defclass wiki-diff (diff:diff) ()
  (:default-initargs
   :window-class 'wiki-diff-window))

(defclass wiki-diff-window (diff:diff-window) ())

(defun choose-chunks (chunks a b c)
  (loop for chunk in chunks appending
       (let ((kind (diff:chunk-kind chunk))
             (lines (diff:chunk-lines chunk)))
         (cond ((or (eq kind :common) (eq kind a)) lines)
               ((eq kind b) (list (format nil "窿扉铄螬┅è羼腴钿悌磲脲扉篝戾铉翳扉铄螬┅┅┅ㄤ彐躅泔眇狎瀛篝蜷铉矧殓轭犰盹溟骈邃灬忮祗è篝虿狎篝颟磲箝眇戾鲥泗矧＇汨狎泔溴篝颟黩篝秕篝狎孱洎祜镳骘骝镯篝狎忮祜孱骘汨ㄣ栳篝椹滹ㄩㄣ栳蚪汨＼五黛轭濠黩轸瀛扉铄⒓怛劲秕舂黩轸瀛汨狎汨秕舂┅ㄦ眙蝈玳镱篝镦骟弭骢戾铉翳骢瞟鏖翳秕麴豸麸篝蜷铉秕舂祜镳骘蝈轭蝈玳镱骘盹溟骈邃豉疱蝈т殒婧盹溟骈邃溟骀蝈玳镱骘篝狎ㄦ躅汜祆镦骟弭骢蝈绌骘孱ǐ篝狎ㄦ躅汜祆戾铉翳骢蝈绌滹痱镧麒孱盹溟骈邃痱轭⒓箴犷篝戾杰泔祜蚝蝈浠堍劲秕舂黩篝秕篝狎孱洎麒孱盹溟骈邃痱轭⒓箴犷劲秕舂┅┅┅戾è蜥麂殒ㄤ殒婧泔眇豸瀛蜥鳝溟骀篝虿狎矧殓轭犰篝虿狎盹溟骈邃┅┅鲠祯弩ㄦ眙蜥麂殒矧殓轭犰＇溟骀猴蜷玳钺飙篝狎＇溟骀猴蜷玳钺飙戾铉翳ㄦ眙蜥麂殒盹溟骈邃＇溟骀喉镤殒殄洵篝狎＇溟骀喉镤殒殄洵戾铉翳┅┅ㄤ彐礤翳镤溟骀候孱溴颦溟骀鏖钿秣衡彐矧è鏖钿秣鏖腴溟骀鏖钿秣梏盱篝蝈犴Ｈ奂趄剪炯翡沆狍蠼溟骀扉铄铛礅弪⒕涕铄ㄤ殒婧矧殓轭犰篝狎舡扉铄鏖钿秣杭翡剪炯翡沆狍蠼溟骀扉铄铛礅弪⒕涕铄ㄤ殒婧盹溟骈邃篝狎舡扉铄鏖钿秣杭翡集趄据ㄤ彐礤翳镤溟骀候孱溴颦溟骀鏖钿秣è鏖钿秣鏖腴溟骀鏖钿秣梏盱篝蝈犴灬忮祗è弩汜疱麒孱ㄥ筱狃瀛骘颦梏盱┅翡扉铄溽箬沆狍篝戾ㄩ扉铄Ｈ奂翡沆狍蠼溟骀磲螂弪⒕溽箬集翡剪沆狍蠼沆狍簖篝戾舰篝戾⒕扉铄集翡据Ｈ奂翡沆狍蠼溟骀磲螂弪炯翡据┅ㄤ殒姝扉铄矧殓轭犰盹溟骈邃翡矧殓轭犰溟骀溴戾翦扉铄⑩徙腌蝻躅洵泔祜蚝Ｆ屏虎翡盹溟骈邃溟骀徜潇轭澧⑩徙腌蝻躅洵泔祜蚝Ｃ泼虎┅祜镳骘矧殓轭犰轭ㄣ栾矬瀛汨躅塍ㄤ殒婧鏖钿秣汨躅塍鏖钿秣轰屐弭候屦灬沐恒蝈狒濠骘盹溟骈邃轭ㄣ栾矬瀛汨躅塍ㄤ殒婧鏖钿秣汨躅塍鏖钿秣恒蝈狒洪铙弪轰屐弭濠滹戾è矧殓轭犰ㄥ筱狃矧殓轭犰┅盹溟骈邃ㄥ筱狃盹溟骈邃┅Ｈ奂趄据ㄩㄡ钿矧殓轭犰盹溟骈邃ㄩ篝蜷铉矧殓轭犰盹溟骈邃Ｈ奂翡沆狍蠼溟骀磲螂弪篝戾舰桢殓梏捍瘌虎剪沆狍蠼溟骀泔铘屮簪篝戾舰忉汶珧秕钿泔祜蚝Ｅ排虎兢矧殓轭犰集翡剪沆狍蠼溟骀磲螂弪剪沆狍蠼溟骀泔铘屮簪篝戾舰忉汶珧秕钿泔祜蚝Ｅ排虎兢矧殓轭犰集翡据眭祠轲戾鲠祯瀛汜祆＇溟骀扉铄ㄣ镯疳蝈篝蜷铉矧殓轭犰盹溟骈邃┅ㄤ殒姝扉铄矧殓轭犰盹溟骈邃┅Ｈ奂趄据┅┅ㄤ彐躅疳翳矧忪犷蝈鲩箝镱ㄩ蝈鲩箝镱蝈鲩箝镱疳翳蝈鲩箝镱鏖腴疳翳㈠眇豉哝殪澧┅ㄤ彐躅躅殒殄洵溟骀怙澌镬潋铄黩戾è溟骀ㄤ殒婧骘蝽狒溟骀篝蜷铉т殒婧躅殒殄洵溟骀疳翳矧忪犷镬潋蝈鲩箝镱疳翳铄黩┅┅篚怏羼溟骀铘璀鲠祯痧泸搴筱犷苘町寇茴溟骀┅┅ㄤ彐躅蝈鲩箝镱鲥蝮轱瞽轭骘扉铍颟Ｈ壑弪箝镱痧蜷铘蝈鲩箝镱扉铍颟Ｈàㄥ溟舡扉铍㈠溟簪┹ㄤ彐躅蝈钿弪躅殒殄洵蝈鲩箝镱溟骀镬潋铄黩Ｈ奂溟篝戾舰骘铘驷黹禊喉镱矬疳沐虎炯怛经麒孱镬潋蝈鲩箝镱鲥蝮轱瞽轭骘扉铍镬潋┅Ｈ奂怛精蝈鲩箝镱鲥蝮轱瞽轭骘扉铍铄黩Ｈ奂怛炯痱寰ㄥ筱狃瀛骘颦梏盱躅殒殄洵溟骀怙澌镬潋铄黩┅集痱寰集溟鼍荸ㄤ彐躅蝈钿弪溟骀翎忪镬潋溟骀磲忮躅滹怩趑镱咯Ｈ奂溟篝戾舰溟箴灬侯镱寤⒕尖疹殒殄骘蝽狒溟骀狠蝈钿弪躅殒殄洵蝈鲩箝镱溟骀镬潋溟骀颟Ｈ墼徕戾骘蝽狒溟骀集溟鼍剪徕戾沆狍蠼溟骀⒕笺镬珧秕鹁笺镬沆狍蠼溟骀磲螂弪⒕笺镬沆狍蠼溟骀泔铘孱簪笺镬沆狍蠼溟骀磲螂弪⒕笺镬沆狍蠼溟骀泔铘孱簪集泔扃蝻躔剪怙澌剪蚓剪泔祗疳罱⒉⒕麒孱镬潋蝈鲩箝镱鲥蝮轱瞽轭骘扉铍镬潋┅Ｈ奂翳剪泔祗疳罱⒉⒕蝈鲩箝镱鲥蝮轱瞽轭骘扉铍溟骀颟麒孱ㄡ钿磲忮躅滹怩趑镱ㄥ溟骀灬翦篝蝈鲩箝镱ㄦ轭洵狎糸沆疳蝈铘糸綮溟骀颟┅┅Ｈ奂骘蝽礤翳镤舰痫篝徙糸镱舰え／箝翦躅滹⒕奸铕豸豉疱舰栝滗孱钺礤舰狎糸沆澧鲠祯褰疳蝈铘糸綮镬潋据秕麴豸躅滹怩趑镱溟骀颟Ｈ奂骘蝽据Ｈ奂翳集趄ㄤ殒婧骘蝽狒溟骀篝蜷铉鏖腴溟骀疳翳矧忪犷镬潋蝈鲩箝镱疳翳溟骀颟集翕镤集翎忪寰荸ㄤ彐疳珏箝翦泔眇狎瀛蝈鲩箝镱īㄡ螋殂戾镬溟骀戾è镬潋ㄦ轭洵蝈鲩箝镱狎糸沆镬洎ㄤ殒骝ㄦ轭洵蝈鲩箝镱狎糸沆溟骀┅躅戾篌ㄡ钿镬潋溟骀颟ㄥ蝌矧⒚犷骈钿翳箴邈殒殄蝈鲩箝镱螈┅麒孱蝈鲩箝镱溽翦镬潋蝈鲩箝镱溽翦溟骀颟蝻翎翦镬潋溟骀颟箦翩糸綮濯？狎糸沆溟骀弪孱沐忮赭邋蝈鲩箝镱螈骘雉弪ㄡ螋殂戾骘雉弪镬潋┅Ｈ奂溟沆狍蠼沐铘弪邃⒕艰本坚沆狍蠼㈤铘弪钺膦栩彐舰ㄡ螋殂戾扉铍狎糸沆濠⒕狎糸沆妪集峋集璞炯溟鼍蝈钿弪溟骀翎忪镬潋溟骀舂┅